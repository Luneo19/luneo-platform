# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘  ğŸ“ EXEMPLE DE CONFIGURATION TERRAFORM - LUNEO AWS               â•‘
# â•‘     Copiez ce fichier vers terraform.tfvars et adaptez           â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ========================================
# CONFIGURATION GLOBALE
# ========================================

project     = "luneo"
environment = "staging" # ou "prod" ou "dev"

# RÃ©gions AWS
primary_region   = "eu-west-1"
secondary_region = "us-east-1"

# ========================================
# RÃ‰SEAUX
# ========================================

vpc_primary_cidr   = "10.10.0.0/16"
vpc_secondary_cidr  = "10.20.0.0/16"
primary_az_count    = 3
secondary_az_count  = 3

# ========================================
# EKS
# ========================================

kubernetes_version = "1.29"

# RÃ©gion primaire
eks_primary_instance_types        = ["m6i.large"]
eks_primary_min_size             = 2
eks_primary_max_size             = 6
eks_primary_desired_size         = 2
eks_primary_spot_instance_types  = ["m6i.large", "m5.large"]
eks_primary_spot_min_size        = 0
eks_primary_spot_max_size        = 4
eks_primary_spot_desired_size    = 1

# RÃ©gion secondaire
eks_secondary_instance_types        = ["m6i.large"]
eks_secondary_min_size             = 1
eks_secondary_max_size             = 4
eks_secondary_desired_size         = 1
eks_secondary_spot_instance_types  = ["m6i.large", "m5.large"]
eks_secondary_spot_min_size        = 0
eks_secondary_spot_max_size        = 2
eks_secondary_spot_desired_size    = 0

create_kubernetes_resources = false # Mettre Ã  true aprÃ¨s configuration kubeconfig

# ========================================
# RDS POSTGRESQL
# ========================================

db_engine_version         = "15.4"
db_name                   = "luneo"
db_master_username        = "luneo_admin"
db_master_password        = "CHANGE_ME_SECURE_PASSWORD_MIN_16_CHARS" # âš ï¸ Ã€ changer!

db_primary_instance_class   = "db.t3.medium"
db_secondary_instance_class  = "db.t3.small"
db_primary_reader_count      = 1
db_backup_retention_days     = 7
db_backup_window            = "04:00-05:00"
db_maintenance_window       = "mon:05:00-mon:06:00"

# ========================================
# S3 + CLOUDFRONT (Assets)
# ========================================

artifact_bucket_suffix = "assets"

# Configuration CloudFront
cloudfront_price_class              = "PriceClass_100" # PriceClass_All, PriceClass_200, PriceClass_100
cloudfront_cache_default_ttl        = 86400
cloudfront_cache_min_ttl            = 0
cloudfront_cache_max_ttl            = 31536000
cloudfront_enable_ipv6              = true
cloudfront_default_root_object      = "index.html"

# ========================================
# REDIS (ElastiCache)
# ========================================

redis_engine_version              = "7.0"
redis_node_type                   = "cache.t3.micro"
redis_num_cache_clusters          = 1
redis_automatic_failover_enabled   = false
redis_multi_az_enabled            = false
redis_snapshot_retention_limit    = 7
redis_snapshot_window             = "03:00-05:00"
redis_at_rest_encryption_enabled  = true
redis_transit_encryption_enabled   = false
redis_auth_token                  = null # Requis si transit_encryption_enabled = true

# ========================================
# ECR (Container Registry)
# ========================================

# Les repositories seront crÃ©Ã©s automatiquement:
# - luneo-worker-ia
# - luneo-usdz-converter

ecr_image_tag_mutability           = "MUTABLE"
ecr_scan_on_push                   = true
ecr_encryption_type                = "AES256"
ecr_keep_last_n_images             = 10
ecr_untagged_image_expiration_days = 7

# ========================================
# KMS (Secrets Management)
# ========================================

# ClÃ©s KMS seront crÃ©Ã©es automatiquement pour:
# - Secrets gÃ©nÃ©raux
# - RDS encryption
# - Redis encryption
# - S3 encryption (si nÃ©cessaire)

kms_deletion_window_days = 30
kms_enable_key_rotation = true

# ========================================
# ROUTE53 & DNS
# ========================================

api_domain_name              = "api.luneo.app"
primary_ingress_hostname      = "CHANGE_ME" # Hostname du load balancer EKS primaire
secondary_ingress_hostname    = "CHANGE_ME" # Hostname du load balancer EKS secondaire
primary_health_check_domain   = "api-primary.luneo.app"
secondary_health_check_domain = "api-secondary.luneo.app"
health_check_path             = "/health"
health_check_port             = 443

# ========================================
# MONITORING & ALERTES
# ========================================

db_replication_lag_threshold      = 45
s3_replication_pending_threshold  = 524288000 # 500 MB

# ========================================
# TAGS
# ========================================

# Tags seront automatiquement ajoutÃ©s Ã  toutes les ressources:
# Project = "luneo"
# Environment = <environment>
# ManagedBy = "Terraform"
# Provisioner = "AWS"

# ========================================
# BACKEND CONFIGURATION
# ========================================

# Le backend S3 est configurÃ© dans main.tf:
# bucket         = "luneo-terraform-state"
# key            = "global/multi-region/terraform.tfstate"
# region         = "eu-west-1"
# dynamodb_table = "luneo-terraform-locks"
# encrypt        = true

# âš ï¸ IMPORTANT: CrÃ©ez ces ressources manuellement avant le premier terraform init:
# 1. S3 bucket: luneo-terraform-state
# 2. DynamoDB table: luneo-terraform-locks (avec partition_key = LockID)

# ========================================
# EXEMPLES PAR ENVIRONNEMENT
# ========================================

# STAGING:
# environment = "staging"
# eks_primary_desired_size = 2
# eks_primary_min_size = 1
# eks_primary_max_size = 4
# db_primary_instance_class = "db.t3.small"
# redis_node_type = "cache.t3.micro"
# redis_num_cache_clusters = 1

# PRODUCTION:
# environment = "prod"
# eks_primary_desired_size = 3
# eks_primary_min_size = 3
# eks_primary_max_size = 9
# db_primary_instance_class = "db.r6g.large"
# redis_node_type = "cache.r6g.large"
# redis_num_cache_clusters = 2
# redis_automatic_failover_enabled = true
# redis_multi_az_enabled = true
# db_backup_retention_days = 30
