"use strict";(()=>{(function(){let d="https://api.luneo.app/api/v1/widget",p=document.currentScript,a=p&&p.getAttribute("data-widget");if(!a||window.__luneo_initialized)return;window.__luneo_initialized=!0;let c=document.createElement("div");c.id="luneo-widget-container",document.body.appendChild(c);let o=c.attachShadow({mode:"closed"}),u=!1,r=localStorage.getItem("luneo_conv_"+a),n=null;fetch(d+"/config/"+a).then(e=>e.json()).then(e=>{n=e,f()}).catch(e=>console.error("[Luneo] Widget config error:",e));function f(){let e=n&&n.color||"#6366F1",t=(n&&n.position||"BOTTOM_RIGHT")==="BOTTOM_LEFT"?"left: 20px;":"right: 20px;";o.innerHTML=`<style>*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif}.luneo-bubble{position:fixed;bottom:20px;${t}z-index:999999;width:60px;height:60px;border-radius:50%;background:${e};color:white;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,0.15);transition:transform 0.2s,box-shadow 0.2s}.luneo-bubble:hover{transform:scale(1.1);box-shadow:0 6px 20px rgba(0,0,0,0.2)}.luneo-bubble svg{width:28px;height:28px}.luneo-window{position:fixed;bottom:90px;${t}z-index:999998;width:380px;max-width:calc(100vw - 40px);height:520px;max-height:calc(100vh - 120px);background:white;border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,0.12);display:none;flex-direction:column;overflow:hidden}.luneo-window.open{display:flex}.luneo-header{background:${e};color:white;padding:16px 20px;display:flex;align-items:center;gap:12px}.luneo-header-avatar{width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,0.2);display:flex;align-items:center;justify-content:center;font-size:18px}.luneo-header-info h3{font-size:15px;font-weight:600}.luneo-header-info p{font-size:12px;opacity:0.8}.luneo-close{margin-left:auto;cursor:pointer;opacity:0.8}.luneo-close:hover{opacity:1}.luneo-messages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px}.luneo-msg{max-width:85%;padding:10px 14px;border-radius:12px;font-size:14px;line-height:1.5;word-wrap:break-word}.luneo-msg.assistant{background:#f3f4f6;color:#1f2937;align-self:flex-start;border-bottom-left-radius:4px}.luneo-msg.user{background:${e};color:white;align-self:flex-end;border-bottom-right-radius:4px}.luneo-msg.typing{opacity:0.6}.luneo-msg.typing::after{content:'u2026u2026u2026';animation:dots 1.5s steps(3) infinite}@keyframes dots{0%{content:'.'}33%{content:'..'}66%{content:'u2026u2026u2026'}}.luneo-input-area{padding:12px 16px;border-top:1px solid #e5e7eb;display:flex;gap:8px;align-items:center}.luneo-input{flex:1;border:1px solid #d1d5db;border-radius:8px;padding:10px 14px;font-size:14px;outline:none;resize:none}.luneo-input:focus{border-color:${e};box-shadow:0 0 0 2px ${e}20}.luneo-send{width:40px;height:40px;border-radius:8px;border:none;background:${e};color:white;cursor:pointer;display:flex;align-items:center;justify-content:center}.luneo-send:disabled{opacity:0.5;cursor:not-allowed}.luneo-send svg{width:18px;height:18px}.luneo-powered{text-align:center;padding:8px;font-size:11px;color:#9ca3af}.luneo-powered a{color:#6b7280;text-decoration:none}@media(max-width:480px){.luneo-window{width:100vw;height:100vh;max-height:100vh;bottom:0;right:0;left:0;border-radius:0}.luneo-bubble{bottom:16px;right:16px}}</style><div class="luneo-bubble" id="luneo-toggle"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg></div><div class="luneo-window" id="luneo-window"><div class="luneo-header"><div class="luneo-header-avatar">${n&&n.agentAvatar||"\u{1F916}"}</div><div class="luneo-header-info"><h3>${n&&n.agentName||"Assistant"}</h3><p>${n&&n.brandName||"En ligne"}</p></div><div class="luneo-close" id="luneo-close"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></div></div><div class="luneo-messages" id="luneo-messages"></div><div class="luneo-input-area"><input class="luneo-input" id="luneo-input" placeholder="${n&&n.placeholder||"Ecrivez votre message..."}" /><button class="luneo-send" id="luneo-send"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9"/></svg></button></div><div class="luneo-powered">Powered by <a href="https://luneo.app" target="_blank">Luneo</a></div></div>`,o.getElementById("luneo-toggle").addEventListener("click",g),o.getElementById("luneo-close").addEventListener("click",g),o.getElementById("luneo-send").addEventListener("click",x),o.getElementById("luneo-input").addEventListener("keypress",function(i){i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),x())}),n&&n.greeting&&l("assistant",n.greeting)}function g(){u=!u;let e=o.getElementById("luneo-window");e&&e.classList.toggle("open",u)}function l(e,s){let t=o.getElementById("luneo-messages");if(!t)return;let i=document.createElement("div");i.className="luneo-msg "+e,i.textContent=s,t.appendChild(i),t.scrollTop=t.scrollHeight}async function x(){let e=o.getElementById("luneo-input"),s=e&&e.value&&e.value.trim();if(!s)return;e.value="",l("user",s);let t=document.createElement("div");t.className="luneo-msg assistant typing",t.textContent="En train de repondre",o.getElementById("luneo-messages").appendChild(t);try{r||(r=(await(await fetch(d+"/conversations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({widgetId:a})})).json()).conversationId,localStorage.setItem("luneo_conv_"+a,r));let h=await(await fetch(d+"/conversations/"+r+"/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s})})).json();t.remove(),l("assistant",h.message&&h.message.content||"Erreur")}catch(i){t.remove(),l("assistant","Desole, une erreur est survenue.")}}})();})();
