[build]
builder = "NIXPACKS"

[deploy]
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
# IMPORTANT: Railway Root Directory peut Ãªtre '.' (racine) ou 'apps/backend'
# La commande dÃ©tecte automatiquement le contexte
startCommand = "bash -c 'if [ -f dist/src/main.js ]; then cd .; elif [ -f apps/backend/dist/src/main.js ]; then cd apps/backend; elif [ -f /app/apps/backend/dist/src/main.js ]; then cd /app/apps/backend; else cd /app; fi && echo \"ğŸ”„ ExÃ©cution migrations Prisma...\" && $(npm config get prefix)/bin/pnpm prisma migrate deploy && echo \"âœ… Migrations appliquÃ©es\" && echo \"ğŸŒ± ExÃ©cution seed...\" && npx tsx prisma/seed.ts || echo \"âš ï¸ Seed ignorÃ© (peut dÃ©jÃ  exister)\" && echo \"ğŸš€ DÃ©marrage application...\" && node dist/src/main.js'"

[env]
NODE_ENV = "production"
# PORT est fourni automatiquement par Railway via $PORT